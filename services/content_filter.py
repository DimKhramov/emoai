"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
"""

import re
from typing import Dict, List, Tuple

class ContentFilter:
    """
    –§–∏–ª—å—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ç–µ–º
    """
    
    # –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Ç–µ–º –∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    INAPPROPRIATE_TOPICS = {
        "sexual_content": {
            "keywords": [
                "–∞–Ω–∞–ª—å–Ω—ã–π —Å–µ–∫—Å", "–∞–Ω–∞–ª", "–æ—Ä–∞–ª—å–Ω—ã–π —Å–µ–∫—Å", "—Å–µ–∫—Å", "–∏–Ω—Ç–∏–º–Ω–æ—Å—Ç—å", 
                "–ø–æ–ª–æ–≤–æ–π –∞–∫—Ç", "–º–∞—Å—Ç—É—Ä–±–∞—Ü–∏—è", "–ø–æ—Ä–Ω–æ", "—ç—Ä–æ—Ç–∏–∫–∞", "–∏–Ω—Ç–∏–º",
                "–ø—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤", "—Å–º–∞–∑–∫–∞", "–≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ", "–æ—Ä–≥–∞–∑–º", "–ª–∏–±–∏–¥–æ"
            ],
            "patterns": [
                r"\b(—Å–µ–∫—Å|–∏–Ω—Ç–∏–º)\w*",
                r"\b(–ø–æ–ª–æ–≤–æ–π|—Å–µ–∫—Å—É–∞–ª—å–Ω)\w*",
                r"\b(—ç—Ä–æ—Ç–∏—á|–ø–æ—Ä–Ω)\w*"
            ],
            "response": "–Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —É —Ç–µ–±—è –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–æ —è —Å–æ–∑–¥–∞–Ω –¥–ª—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –¥—Ä—É–∂–µ—Å–∫–æ–≥–æ –æ–±—â–µ–Ω–∏—è. –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–Ω—Ç–∏–º–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º. üòä\n\n–î–∞–≤–∞–π –ª—É—á—à–µ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Ç–æ–º, –∫–∞–∫ –¥–µ–ª–∞? –ß—Ç–æ —Ç–µ–±—è —Å–µ–π—á–∞—Å –≤–æ–ª–Ω—É–µ—Ç?"
        },
        
        "violence": {
            "keywords": [
                "—É–±–∏—Ç—å", "—É–±–∏–π—Å—Ç–≤–æ", "–Ω–∞—Å–∏–ª–∏–µ", "–∏–∑–±–∏—Ç—å", "–¥—Ä–∞–∫–∞", "–≤–æ–π–Ω–∞",
                "–æ—Ä—É–∂–∏–µ", "–Ω–æ–∂", "–ø–∏—Å—Ç–æ–ª–µ—Ç", "–∫—Ä–æ–≤—å", "—Å–º–µ—Ä—Ç—å"
            ],
            "patterns": [
                r"\b(—É–±—å|—É–±–∏–≤)\w*",
                r"\b(–Ω–∞—Å–∏–ª|–∏–∑–±–∏–≤)\w*",
                r"\b(–æ—Ä—É–∂|–Ω–æ–∂|–ø–∏—Å—Ç–æ–ª)\w*"
            ],
            "response": "–Ø –≤–∏–∂—É, —á—Ç–æ —Ç–µ–º–∞ –¥–æ–≤–æ–ª—å–Ω–æ —Ç—è–∂–µ–ª–∞—è. –ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ —Å–ª–æ–∂–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, —è –∑–¥–µ—Å—å. –ù–æ –¥–∞–≤–∞–π –Ω–∞–π–¥–µ–º –±–æ–ª–µ–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±—Å—É–¥–∏—Ç—å —Ç–æ, —á—Ç–æ —Ç–µ–±—è –±–µ—Å–ø–æ–∫–æ–∏—Ç. üíô\n\n–ß—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç? –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
        },
        
        "drugs": {
            "keywords": [
                "–Ω–∞—Ä–∫–æ—Ç–∏–∫–∏", "–∫–æ–∫–∞–∏–Ω", "–≥–µ—Ä–æ–∏–Ω", "–º–∞—Ä–∏—Ö—É–∞–Ω–∞", "–∞–º—Ñ–µ—Ç–∞–º–∏–Ω",
                "—ç–∫—Å—Ç–∞–∑–∏", "–ª—Å–¥", "—Å–ø–∞–π—Å", "—Å–æ–ª—å", "–¥–æ–∑—É", "—É–∫–æ–ª"
            ],
            "patterns": [
                r"\b(–Ω–∞—Ä–∫–æ—Ç|–¥–æ–∑—É|—É–∫–æ–ª)\w*",
                r"\b(–∫–æ–∫–∞–∏–Ω|–≥–µ—Ä–æ–∏–Ω|–º–∞—Ä–∏—Ö—É–∞–Ω)\w*"
            ],
            "response": "–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏. –ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞, —è —Ä—è–¥–æ–º. –ù–æ –¥–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º. üåø\n\n–†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ —Ç–µ–±—è —Å–µ–π—á–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç? –ö–∞–∫ –¥–µ–ª–∞ –≤ —Ü–µ–ª–æ–º?"
        }
    }
    
    @classmethod
    def check_content(cls, message: str) -> Tuple[bool, str, str]:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
        
        Args:
            message: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            
        Returns:
            Tuple[bool, str, str]: (is_inappropriate, topic_type, suggested_response)
        """
        message_lower = message.lower()
        
        for topic_type, topic_data in cls.INAPPROPRIATE_TOPICS.items():
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
            for keyword in topic_data["keywords"]:
                if keyword.lower() in message_lower:
                    return True, topic_type, topic_data["response"]
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
            for pattern in topic_data["patterns"]:
                if re.search(pattern, message_lower, re.IGNORECASE):
                    return True, topic_type, topic_data["response"]
        
        return False, "", ""
    
    @classmethod
    def is_question_about_inappropriate_topic(cls, message: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–º –æ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–π —Ç–µ–º–µ
        
        Args:
            message: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            
        Returns:
            bool: True –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å –æ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–π —Ç–µ–º–µ
        """
        question_indicators = ["?", "–∫–∞–∫", "—á—Ç–æ", "–≥–¥–µ", "–∫–æ–≥–¥–∞", "–ø–æ—á–µ–º—É", "–∑–∞—á–µ–º", "—Ä–∞—Å—Å–∫–∞–∂–∏", "–æ–±—ä—è—Å–Ω–∏"]
        message_lower = message.lower()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤–æ–ø—Ä–æ—Å–∞
        has_question = any(indicator in message_lower for indicator in question_indicators)
        
        if has_question:
            is_inappropriate, _, _ = cls.check_content(message)
            return is_inappropriate
        
        return False
    
    @classmethod
    def get_safe_response_for_topic(cls, topic_type: str) -> str:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–µ–º—ã
        
        Args:
            topic_type: –¢–∏–ø –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–π —Ç–µ–º—ã
            
        Returns:
            str: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç
        """
        if topic_type in cls.INAPPROPRIATE_TOPICS:
            return cls.INAPPROPRIATE_TOPICS[topic_type]["response"]
        
        # –û–±—â–∏–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç
        return """–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ —É —Ç–µ–±—è –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–æ —è —Å–æ–∑–¥–∞–Ω –¥–ª—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –¥—Ä—É–∂–µ—Å–∫–æ–≥–æ –æ–±—â–µ–Ω–∏—è. üòä

–î–∞–≤–∞–π –ª—É—á—à–µ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Ç–æ–º, –∫–∞–∫ —É —Ç–µ–±—è –¥–µ–ª–∞? –ß—Ç–æ —Ç–µ–±—è —Å–µ–π—á–∞—Å –≤–æ–ª–Ω—É–µ—Ç –∏–ª–∏ —Ä–∞–¥—É–µ—Ç?"""